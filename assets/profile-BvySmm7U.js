import{r as n,j as e,c as d,u as c,a as oe,b as ne,P as de,L as v,B as N,d as ce,F as ie,e as R,f as M,q as L,w as q,g as I}from"./index-Crx7_nw7.js";const D=a=>n.forwardRef((s,t)=>e.jsx("div",{...s,ref:t,className:d(s.className,a)})),k=n.forwardRef(({className:a,bsPrefix:s,as:t="div",...r},o)=>(s=c(s,"card-body"),e.jsx(t,{ref:o,className:d(a,s),...r})));k.displayName="CardBody";const O=n.forwardRef(({className:a,bsPrefix:s,as:t="div",...r},o)=>(s=c(s,"card-footer"),e.jsx(t,{ref:o,className:d(a,s),...r})));O.displayName="CardFooter";const V=n.createContext(null);V.displayName="CardHeaderContext";const A=n.forwardRef(({bsPrefix:a,className:s,as:t="div",...r},o)=>{const i=c(a,"card-header"),l=n.useMemo(()=>({cardHeaderBsPrefix:i}),[i]);return e.jsx(V.Provider,{value:l,children:e.jsx(t,{ref:o,...r,className:d(s,i)})})});A.displayName="CardHeader";const b=n.forwardRef(({bsPrefix:a,className:s,variant:t,as:r="img",...o},i)=>{const l=c(a,"card-img");return e.jsx(r,{ref:i,className:d(t?`${l}-${t}`:l,s),...o})});b.displayName="CardImg";const z=n.forwardRef(({className:a,bsPrefix:s,as:t="div",...r},o)=>(s=c(s,"card-img-overlay"),e.jsx(t,{ref:o,className:d(a,s),...r})));z.displayName="CardImgOverlay";const G=n.forwardRef(({className:a,bsPrefix:s,as:t="a",...r},o)=>(s=c(s,"card-link"),e.jsx(t,{ref:o,className:d(a,s),...r})));G.displayName="CardLink";const le=D("h6"),P=n.forwardRef(({className:a,bsPrefix:s,as:t=le,...r},o)=>(s=c(s,"card-subtitle"),e.jsx(t,{ref:o,className:d(a,s),...r})));P.displayName="CardSubtitle";const W=n.forwardRef(({className:a,bsPrefix:s,as:t="p",...r},o)=>(s=c(s,"card-text"),e.jsx(t,{ref:o,className:d(a,s),...r})));W.displayName="CardText";const me=D("h5"),J=n.forwardRef(({className:a,bsPrefix:s,as:t=me,...r},o)=>(s=c(s,"card-title"),e.jsx(t,{ref:o,className:d(a,s),...r})));J.displayName="CardTitle";const K=n.forwardRef(({bsPrefix:a,className:s,bg:t,text:r,border:o,body:i=!1,children:l,as:y="div",...C},w)=>{const S=c(a,"card");return e.jsx(y,{ref:w,...C,className:d(s,S,t&&`bg-${t}`,r&&`text-${r}`,o&&`border-${o}`),children:i?e.jsx(k,{children:l}):l})});K.displayName="Card";const F=Object.assign(K,{Img:b,Title:J,Subtitle:P,Body:k,Link:G,Text:W,Header:A,Footer:O,ImgOverlay:z});function ue(){const{user:a,profile:s,loading:t}=oe();ne();const[r,o]=n.useState([]),[i,l]=n.useState(!0),[y,C]=n.useState([]),[w,S]=n.useState(!0),[B,Q]=n.useState(0),[X,Y]=n.useState(0),[Z,_]=n.useState(0);return n.useEffect(()=>{const u=async()=>{if(!a)return;const h=R(M,"projects"),j=L(h,q("ownerId","==",a.uid));try{const x=(await I(j)).docs.map(f=>({id:f.id,...f.data()}));o(x)}catch(m){console.error("Error fetching projects: ",m)}finally{l(!1)}},ee=async()=>{if(!a)return;const h=R(M,"savedMaterials"),j=L(h,q("userId","==",a.uid));try{const x=(await I(j)).docs.map(f=>({id:f.id,...f.data()}));C(x)}catch{console.error("Error fetching saved materials:",errors)}finally{S(!1)}},se=async()=>{if(!a)return;const h=R(M,"conversations"),j=L(h,q("participants","array-contains",a.uid));try{const m=await I(j);Q(m.size);let x=0,f=0;m.docs.forEach(ae=>{var H,p,T,$,g,U;const E=ae.data(),te=((T=(p=(H=E.lastMessage)==null?void 0:H.timestamp)==null?void 0:p.toMillis)==null?void 0:T.call(p))||0,re=((U=(g=($=E.lastReadBy)==null?void 0:$[a.uid])==null?void 0:g.toMillis)==null?void 0:U.call(g))||0;te>re?f++:x++}),Y(x),_(f)}catch(m){console.error("Error fetching conversations:",m)}};u(),ee(),se()},[a]),t?e.jsx("p",{children:"Loading..."}):!a||!s?e.jsx("p",{children:"User not found nor not logged in."}):e.jsxs(e.Fragment,{children:[e.jsx("meta",{charSet:"UTF-8"}),e.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),e.jsx("title",{children:"Profile"}),e.jsx(de,{}),e.jsx("div",{className:"main-content max-w-6xl mx-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mt-24 ",children:[e.jsxs("div",{className:"md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(F,{children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Projects"}),i?e.jsx("p",{className:"text-gray-500",children:"Loading project stats..."}):e.jsxs("p",{className:"text-gray-500",children:[r.filter(u=>u.status==="submitted").length," Submitted, "," ",r.filter(u=>u.status==="inquiry").length," Pending, "," ",r.filter(u=>u.status==="completed").length," Completed"]}),e.jsx(v,{to:"/projects",children:e.jsx(N,{variant:"link",className:"mt-2",children:"View projects"})})]})}),e.jsx(F,{children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Saved Items"}),w?e.jsx("p",{className:"text-gray-500",children:"Loading saved materials..."}):e.jsxs("p",{className:"text-gray-500",children:[y.length," Materials Favorited"]}),e.jsx(v,{to:"/savedItems",children:e.jsx(N,{variant:"link",className:"mt-2",children:"View Favorites"})})]})}),e.jsx(F,{children:e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Messages & Notifications"}),e.jsxs("p",{className:"text-gray-500",children:[B," Conversation",B!==1?"s":""," â€”",Z,"  Unread, ",X," Read"]}),e.jsx(v,{to:"/messages",children:e.jsx(N,{variant:"link",className:"mt-2",children:"Go to Messages"})})]})})]}),e.jsxs("div",{className:"flex flex-col items-center md:col-span-1 text-center ",children:[e.jsx("h2",{className:"text-2xl font-bold mt-4",children:s.username||a.displayName}),e.jsx("img",{src:ce}),e.jsx("p",{className:"text-gray-500",children:a.email}),e.jsx(v,{to:"/edit-profile",children:e.jsx(N,{className:"mt-2",children:"Edit Profile"})})]})]})}),e.jsx(ie,{})]})}export{ue as default};
