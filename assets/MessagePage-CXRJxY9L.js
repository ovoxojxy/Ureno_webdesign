import{f as g,k as h,r as p,q as f,w as j,g as v,h as m,o as b,j as e,L as N,m as y,l as C,s as x,n as S,p as E}from"./index-zGRfcon2.js";function w(){const{state:o,dispatch:r}=g(),{currentUser:s}=h();p.useEffect(()=>{if(!s){console.log("No current user found â€” exiting useEffect.");return}console.log("Current user UID:",s.uid);const t=f(v(m,"conversations"),j("participants","array-contains",s.uid)),i=b(t,d=>{console.log("onSnapshot triggered");const c=[];d.forEach(u=>{c.push({id:u.id,...u.data()})}),console.log("Fetched conversations:",c),r({type:"SET_CONVERSATIONS",payload:c})});return()=>i()},[s,r]),console.log("Conversations in state:",o.conversations);const l=t=>{console.log(`Selecting conversation: ${t}, current selection: ${o.selectedConversation}`),r({type:"SELECT_CONVERSATION",payload:t})},n=o.conversations,a=o.selectedConversation&&!n.some(t=>t.id===o.selectedConversation)?{id:o.selectedConversation,projectId:"Selected Conversation"}:null;return console.log("Selected conversation:",o.selectedConversation),console.log("Visible conversations:",n.map(t=>t.id)),e.jsxs("div",{className:"conversation-list",children:[e.jsxs("div",{className:"flex items-center gap-3 ",children:[e.jsx(N,{to:"/ProfileDashboard",className:"text-blue-500 text-3xl font-bold hover:scale-110 hover:text-blue-700 transition-all duration-200 flex items-center justify-center",children:"<"}),e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Conversations"})]}),n.length===0&&!a?e.jsx("p",{children:"No conversations yet."}):e.jsxs("ul",{className:"space-y-4",children:[n.map(t=>{var i;return e.jsxs("li",{onClick:()=>l(t.id),className:`cursor-pointer p-3 rounded-md ${o.selectedConversation===t.id?"bg-blue-100 border-2 border-blue-500":"bg-gray-100"}`,children:[e.jsxs("div",{className:"font-semibold",children:["Project: ",t.projectId]}),e.jsx("div",{className:"text-sm text-gray-600",children:(i=t.lastMessage)!=null&&i.text?`${t.lastMessage.text.slice(0,30)}...`:"No messages yet"})]},t.id)}),a&&e.jsxs("li",{onClick:()=>l(a.id),className:"cursor-pointer p-3 rounded-md bg-blue-100 border-2 border-blue-500",children:[e.jsxs("div",{className:"font-semibold",children:["Project: ",a.projectId]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Currently selected conversation"})]},a.id)]})]})}function I(){const{state:o,dispatch:r}=g(),{currentUser:s}=h(),{selectedConversation:l}=o;return p.useEffect(()=>{if(!l)return;console.log("Loading messages for conversation:",l),console.log("Current user UID:",s==null?void 0:s.uid);const n=v(m,"conversations",l,"messages"),a=f(n,y("timestamp","asc")),t=b(a,i=>{const d=i.docs.map(c=>({id:c.id,...c.data()}));console.log("Fetched messages:",d),r({type:"SET_MESSAGES",payload:d})});return()=>t()},[l,r,s==null?void 0:s.uid]),l?(console.log("Rendering messages with currentUser:",s==null?void 0:s.uid),e.jsx("div",{className:"p-4 space-y-3 overflow-y-auto max-h-[70vh]",children:o.messages.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"No messages in this conversation yet"}):o.messages.map(n=>{var t;const a=n.senderId===(s==null?void 0:s.uid);return console.log(`Message ${n.id}: senderId=${n.senderId}, currentUser=${s==null?void 0:s.uid}, isSent=${a}`),e.jsx("div",{className:`flex ${a?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`p-2 rounded-md max-w-xs ${a?"bg-blue-500 text-white":"bg-gray-200"}`,children:[e.jsx("div",{className:"text-sm",children:n.text}),e.jsx("div",{className:`text-xs ${a?"text-blue-100":"text-gray-500"} text-right`,children:(t=n.timestamp)==null?void 0:t.toDate().toLocaleString()})]})},n.id)})})):e.jsx("div",{className:"p-4",children:"No Conversation Selected"})}function $(){const[o,r]=p.useState(""),{state:s,dispatch:l}=g(),{currentUser:n}=h(),{selectedConversation:a}=s,t=async i=>{if(i.preventDefault(),!o.trim())return;const d={senderId:n.uid,text:o.trim(),timestamp:x()},c=v(m,"conversations",a,"messages");await C(c,d);const u=S(m,"conversations",a);await E(u,{lastMessage:{text:d.text,senderId:n.uid,timestamp:x()},updatedAt:x()}),r("")};return a?e.jsxs("form",{onSubmit:t,className:"flex items-center p-4 border-t",children:[e.jsx("input",{type:"text",placeholder:"Type a message...",value:o,onChange:i=>r(i.target.value),className:"flex-1 p-2 border rounded-md"}),e.jsx("button",{type:"submit",className:"ml-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Send"})]}):null}function D(){return e.jsxs("div",{className:"flex h-[calc(100vh-4rem)]",children:[e.jsx("aside",{className:"w-1/3 border-r overflow-y-auto",children:e.jsx(w,{})}),e.jsxs("main",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(I,{})}),e.jsx($,{})]})]})}export{D as default};
